% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/postprocess_functions.R
\name{spatial_smooth}
\alias{spatial_smooth}
\title{Apply SUSAN-based spatial smoothing to a 4D fMRI image}
\usage{
spatial_smooth(
  in_file,
  prefix = "s",
  fwhm_mm = 6,
  brain_mask = NULL,
  overwrite = FALSE,
  log_file = NULL,
  fsl_img = NULL
)
}
\arguments{
\item{in_file}{Path to the input 4D NIfTI file.}

\item{prefix}{Prefix to prepend to the output file name.}

\item{fwhm_mm}{Full-width at half-maximum (FWHM) of the Gaussian kernel in millimeters.}

\item{brain_mask}{Optional brain mask to guide intensity thresholding. If \code{NULL}, the whole image is used.}

\item{overwrite}{Logical; whether to overwrite the output file if it already exists.}

\item{log_file}{Optional path to a file for logging the FSL command output.}

\item{fsl_img}{Optional Singularity image to execute FSL commands in a containerized environment.}
}
\value{
Path to the spatially smoothed output NIfTI file.
}
\description{
Performs spatial smoothing using FSL's \code{susan} algorithm, which adapts smoothing based
on local image intensity structure. A smoothing kernel defined by \code{fwhm_mm} is applied
and the extents mask is re-applied post-smoothing to constrain the result to original data extents.
}
\details{
The SUSAN threshold is computed based on the 2nd and 50th percentiles of intensity values.
An extents mask is created prior to smoothing to ensure no new voxels are introduced in the output.
}
\keyword{internal}
